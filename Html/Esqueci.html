<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<input id="usuario" placeholder="usuario"> <!-- Alterado para um ID mais descritivo -->
<input id="novaSenha" placeholder="nova senha"> <!-- Alterado para um ID mais descritivo -->
<input id="confirmarSenha" placeholder="confirmar senha"> <!-- Alterado para um ID mais descritivo -->
<button id="btnAlterar">Alterar</button> <!-- Alterado para um ID mais descritivo -->
<button onclick="voltar()">Voltar</button>
<script>
   document.addEventListener("DOMContentLoaded", () => {
    const btnAlterar = document.getElementById("btnAlterar");
    if (btnAlterar) {
      btnAlterar.addEventListener("click", recebe);
    }
  });

  async function recebe(){ // Tornar a função assíncrona
            var n1 = document.getElementById("novaSenha").value; // Usar o ID correto
            var n2 = document.getElementById("confirmarSenha").value; // Usar o ID correto
            var n3 = document.getElementById("usuario").value; // Usar o ID correto
            if(n1 === n2){ // Usar === para comparação estrita
           const data = new URLSearchParams();
data.append('n1', n1);
// data.append('n2', n2); // Não é necessário enviar n2 para o PHP se ele só usa n1
data.append('n3', n3); // Enviar o usuário
try {
  const response = await fetch('http://localhost/ETEC/3MIN/TCC/bioid/Php/esqueci.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: data.toString()
  });

  if (!response.ok) throw new Error('Erro na requisição: ' + response.statusText);

  const result = await response.json(); // ✅ lê só uma vez
  console.log("Resposta:", result);

  if (result.success) {
    alert(result.message);
    // await window.electronAPI.trocarPagina('login');
  } else {
    alert("Erro: " + result.message);
  }

} catch (error) {
  console.log('Request failed: ' + error.message);
  alert("Erro ao alterar senha: " + error.message);
} finally {
  console.log('Foi');
}

        }
        else{
          alert("As senhas não coincidem");
        }
      }
      function voltar() {
        window.electronAPI.trocarPagina("login");
      }
    </script>
</body>
</html>
